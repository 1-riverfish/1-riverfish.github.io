<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="1-riverfish"><title>MongoDB学习笔记2 · Ginger's blog</title><meta name="description" content="MongoDB学习笔记2基本概念


实例
一个实例可以拥有多个相互独立的数据库
instance




数据库
数据库拥有自己的集合，一个或多个
database


集合
集合可以看作是一个拥有动态模式(dynamic schema)的表
collection


文档
数据的基本单元，类似于"><meta name="keywords" content=""><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/style.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div id="stage" class="container"><div class="row"><div id="side-bar" class="col-sm-3 col-xs-12 side-container invisible"><div class="vertical-text site-title"><h3 tabindex="-1" class="site-title-small"><a href="/" class="a-title">Share&amp;Joy</a></h3><h1 tabindex="-1" class="site-title-large"><a href="/" class="a-title">Ginger' Blog</a></h1><!--h6(onclick="triggerSiteNav()") Trigger--></div><br class="visible-lg visible-md visible-sm"><div id="site-nav" class="site-title-links"><ul><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li><li><a href="/tags">标签</a></li><li class="soc"><a href="https://github.com/1-riverfish" target="_blank" rel="noopener noreferrer"><i class="fa fa-github">&nbsp;</i></a><a href="http://yoursite.com/atom.xml" target="_blank" rel="noopener noreferrer"><i class="fa fa-rss">&nbsp;</i></a></li></ul><div class="visible-lg visible-md visible-sm site-nav-footer"><br class="site-nav-footer-br"><footer><p>&copy;&nbsp;2018&nbsp;<a target="_blank" href="http://yoursite.com" rel="noopener noreferrer">1-riverfish</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p></footer></div></div></div><div id="main-container" class="col-sm-9 col-xs-12 main-container invisible"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post-container"><p class="post-title"><a>MongoDB学习笔记2</a></p><p class="post-meta"><span class="date meta-item">发布于&nbsp;2017-09-23</span><span class="meta-item"><i class="fa fa-tag"></i><span>&nbsp;</span><a href="/tags/MongoDB/" title="MongoDB" class="a-tag">MongoDB</a><span>&nbsp;</span><a href="/tags/数据库/" title="数据库" class="a-tag">数据库</a><span>&nbsp;</span></span></p><p class="post-abstract"><h1 id="MongoDB学习笔记2"><a href="#MongoDB学习笔记2" class="headerlink" title="MongoDB学习笔记2"></a>MongoDB学习笔记2</h1><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><table>
<thead>
<tr>
<th>实例</th>
<th style="text-align:center">一个实例可以拥有多个相互独立的数据库</th>
<th>instance</th>
</tr>
</thead>
<tbody>
<tr>
<td>数据库</td>
<td style="text-align:center">数据库拥有自己的集合，一个或多个</td>
<td>database</td>
</tr>
<tr>
<td>集合</td>
<td style="text-align:center">集合可以看作是一个拥有动态模式(dynamic schema)的表</td>
<td>collection</td>
</tr>
<tr>
<td>文档</td>
<td style="text-align:center">数据的基本单元，类似于关系型数据库管理系统中的行，都有一个特殊的键“_id”,这个键在文档所属的集合中是唯一的</td>
<td>file</td>
</tr>
</tbody>
</table>
<blockquote>
<ul>
<li>文档</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//例文档</span><br><span class="line">//包含一个键值对</span><br><span class="line">&#123;&quot;greeting&quot;:&quot;hello,world!&quot;&#125;</span><br><span class="line"></span><br><span class="line">//包含多个键值对</span><br><span class="line">&#123;&quot;greeting&quot;:&quot;hello,world!&quot;,&quot;foo&quot;:3&#125;</span><br><span class="line">//文档中的值可以是多种不同的数据类型</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li><p>文档的键是字符串</p>
<ul>
<li>键不能含有\0(空字符)，这个字符用于表示键的结尾</li>
<li><strong>. 和$</strong>具有特殊的意义，只能在特定环境下使用</li>
</ul>
</li>
<li><p>MongoDB<strong>区分类型和大小写</strong></p>
</li>
<li><p>文档不能有重复的键</p>
</li>
<li><p><strong>文档的键/值对是有序的</strong></p>
<hr>
</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li><p>集合</p>
<p>集合就是一组文档</p>
</li>
<li><p>动态模式</p>
<p>动态模式意味着一个集合里的文档可以是多种多样的，尽管MongoDB没有强制要求，我们还是要创建一个模式，把相关文档组合在一起</p>
<ul>
<li>方便开发者，管理者</li>
<li>分开查询多个集合速度快</li>
<li>把相同类型的文档放在一个集合里，数据会更加集中</li>
<li>更有效地对集合进行索引</li>
</ul>
</li>
<li><p>集合命名</p>
<ul>
<li>集合名不能是“”(空字符串)</li>
<li>集合名不能包含\0字符</li>
<li>集合名不能以  <strong>system.</strong>  开头</li>
<li>用户创建的集合，不能在集合名中包含保留字符 <strong>$</strong></li>
</ul>
</li>
<li><p>子集合</p>
<p>组织集合的一种惯例是使用  <strong>.</strong>  分隔不同命名空间的子集合。例如一个具有博客功能的应用可能包含两个集合，分别是blog.posts和blog.authors,这里的  blog  集合跟他的子集合没有任何关系。</p>
<p>在MongoDB中，使用子集合来组织数据非常高效。</p>
</li>
</ul>
</blockquote>
<hr>
<blockquote>
<ul>
<li><p>数据库</p>
<p>每个数据库由0个或多个集合组成，都有独立的权限，即便是在磁盘上，不同的数据库也放在不同的文件中。按<strong>照经验，我们将有关一个应用程序的所有数据都存储在同一个数据库中。</strong></p>
</li>
<li><p>数据库最终会变成系统里的文件，而数据库名就是相应的文件名</p>
</li>
<li><p>保留名字的数据库，可以直接访问这些具有特殊语义的数据库</p>
</li>
</ul>
</blockquote>
<table>
<thead>
<tr>
<th>admin</th>
<th>从身份验证角度讲，这是 “root” 数据库。如果将一个用户添加到admin数据库，这个用户将自动获得所有数据库的权限。再者，一些特定服务器端命令也只能从admin数据库运行，如列出所有数据库或关闭服务器。</th>
</tr>
</thead>
<tbody>
<tr>
<td>local</td>
<td>这个数据库永远都不可以复制，且一台服务器上的所有本地集合都可以存储在这个数据库中。</td>
</tr>
<tr>
<td>config</td>
<td>分片设置，分片信息会存储在config数据库。</td>
</tr>
</tbody>
</table>
<blockquote>
<p>把数据库名添加到集合名前，得到集合的完全限定名，即命名空间(namespace)。例如，cms.blog.posts</p>
</blockquote>
<hr>
<blockquote>
<ul>
<li><p>MongoDB shell简介</p>
<p>MongoDB自带JavaScript shell,可在shell中使用命令行与MongoDB实例交互。</p>
<ol>
<li><code>mongo</code>  启动shell,启动时shell将自动连接MongoDB服务器，须确保mongod已启动。</li>
<li>shell是一个功能完备的JavaScript解释器，可运行任意JS程序    </li>
</ol>
</li>
</ul>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//简单的数学运算</span></span><br><span class="line">&gt; x = <span class="number">200</span>;</span><br><span class="line"><span class="number">200</span></span><br><span class="line">&gt; x / <span class="number">5</span>;</span><br><span class="line"><span class="number">40</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//JS标准库</span></span><br><span class="line">&gt; <span class="built_in">Math</span>.sin(<span class="built_in">Math</span>.PI / <span class="number">2</span>);</span><br><span class="line"><span class="number">1</span></span><br><span class="line">&gt; <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">"2017/9/24"</span>);</span><br><span class="line"><span class="string">"ISODate("</span><span class="number">2017</span><span class="number">-09</span><span class="number">-23</span>T16:<span class="number">00</span>:<span class="number">00</span>Z<span class="string">")"</span></span><br><span class="line">&gt; <span class="string">"hello,world"</span>.replace(<span class="string">"world"</span>,<span class="string">"MongoDB"</span>);</span><br><span class="line">hello,MongoDB</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义和调用JS函数</span></span><br><span class="line">&gt; fuction factorial(n)&#123;<span class="comment">//输入一个&#123; 按回车，进入下一行</span></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line">&gt; factorial(<span class="number">5</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>需要注意，可使用多行命令。shell会检测输入的JS语句是否完整，如没写完可在下一行接着写。在某行连续三次按下回车键可取消输入未完成的命令，并退回到提示符。</p>
</blockquote>
<blockquote>
<ul>
<li><p>MongoDB客户端</p>
<p>shell是一个独立的MongoDB客户端。启动时，shell会连接到MongoDB服务器的test数据库，并将数据库连接赋值给全局变量db。这个变量是通过shell访问MongoDB的主要入口点。</p>
</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//查看db当前指向哪个数据库</span><br><span class="line">&gt; db</span><br><span class="line">test</span><br><span class="line"></span><br><span class="line">//shell包含一些非JS语法的扩展，并非提供额外的功能，而是一些非常棒的语法糖。例如选择数据库</span><br><span class="line">&gt; use foobar</span><br><span class="line">switched to db foobar</span><br><span class="line">&gt; db</span><br><span class="line">foobar</span><br><span class="line">//通过db变量，可访问其中的集合。例如，通过db.baz可返回当前数据库的baz集合</span><br><span class="line">&gt; db.baz</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>shell中的基本操作  CRUD</li>
</ul>
</blockquote>
<ul>
<li>创建 C</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//insert函数，可将一个文档添加到集合中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个名为post的局部变量，这是一个JS对象</span></span><br><span class="line">&gt; post = &#123;</span><br><span class="line">  <span class="string">"title"</span>:<span class="string">"My Blog"</span>,</span><br><span class="line">  <span class="string">"content"</span>:<span class="string">"Hello"</span>,</span><br><span class="line">  <span class="string">"date"</span>:<span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//在 MongoDB 中，不需要创建集合。当插入一些文档时，MongoDB 会自动创建集合。</span></span><br><span class="line">&gt; db.blog.insert(post);</span><br><span class="line"></span><br><span class="line"><span class="comment">//要查看它可调用集合的find()方法</span></span><br><span class="line">&gt; db.blog.find()</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"59c7a8c3a65294893d568ef2"</span>), <span class="string">"title"</span> : <span class="string">"你好"</span>, <span class="string">"content"</span> : <span class="string">"My Name is 1-riverfish"</span>, <span class="string">"date"</span> : ISODate(<span class="string">"2017-09-24T12:43:39.005Z"</span>) &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>读取</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//find和findOne方法。若只想查看一个文档，可用findOne</span><br><span class="line">&gt; db.blog.findOne()</span><br><span class="line">&#123;</span><br><span class="line">	&quot;_id&quot; : ObjectId(&quot;59c7a8c3a65294893d568ef2&quot;),</span><br><span class="line">	&quot;title&quot; : &quot;你好&quot;,</span><br><span class="line">	&quot;content&quot; : &quot;My Name is 1-riverfish&quot;,</span><br><span class="line">	&quot;date&quot; : ISODate(&quot;2017-09-24T12:43:39.005Z&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>find和findOne可以接受一个查询文档作为限定条件。</p>
<p><code>show dbs</code><strong>空的数据库是不显示出来的</strong></p>
<ul>
<li>更新</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//update接受（至少）两个参数：第一个是限定条件（用于匹配待更新的文档），第二个是新文档</span></span><br><span class="line">&gt; post.comments=<span class="string">"写地不错"</span></span><br><span class="line">写地不错</span><br><span class="line">&gt; post</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"title"</span> : <span class="string">"你好"</span>,</span><br><span class="line">	<span class="string">"content"</span> : <span class="string">"My Name is 1-riverfish"</span>,</span><br><span class="line">	<span class="string">"date"</span> : ISODate(<span class="string">"2017-09-24T12:43:39.005Z"</span>),</span><br><span class="line">	<span class="string">"comments"</span> : <span class="string">"写地不错"</span></span><br><span class="line">&#125;</span><br><span class="line">&gt; db.blog.update(&#123;<span class="string">"title"</span>:<span class="string">"你好"</span>&#125;,post)</span><br><span class="line">WriteResult(&#123; <span class="string">"nMatched"</span> : <span class="number">1</span>, <span class="string">"nUpserted"</span> : <span class="number">0</span>, <span class="string">"nModified"</span> : <span class="number">1</span> &#125;)</span><br><span class="line">&gt; db.blog.findOne()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"_id"</span> : ObjectId(<span class="string">"59c7a8c3a65294893d568ef2"</span>),</span><br><span class="line">	<span class="string">"title"</span> : <span class="string">"你好"</span>,</span><br><span class="line">	<span class="string">"content"</span> : <span class="string">"My Name is 1-riverfish"</span>,</span><br><span class="line">	<span class="string">"date"</span> : ISODate(<span class="string">"2017-09-24T12:43:39.005Z"</span>),</span><br><span class="line">	<span class="string">"comments"</span> : <span class="string">"写地不错"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>删除</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//remove方法，没有任何参数，它会将集合内的所有文档全部删除。它可以接受一个作为限定条件的文档作为参数</span></span><br><span class="line">&gt; db.blog.remove(&#123;<span class="string">"title"</span>:<span class="string">"你好"</span>&#125;)</span><br><span class="line">WriteResult(&#123; <span class="string">"nRemoved"</span> : <span class="number">1</span> &#125;)</span><br><span class="line">&gt; db.blog.find()</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>数据类型</li>
</ul>
<p>在概念上，MongoDB的文档与JS中的对象类似，可认为它类似于<a href="http://json.org" target="_blank" rel="noopener">JSON</a>.MongoDB在保留JSON基本键/值对的基础上，增添了一些其他的数据类型。</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>定义</th>
<th>例子</th>
</tr>
</thead>
<tbody>
<tr>
<td>null</td>
<td>空值或者不存在的字段</td>
<td>{“x”:null}</td>
</tr>
<tr>
<td>布尔型</td>
<td>true/false</td>
<td>{“x”:true}</td>
</tr>
<tr>
<td>数值/NumberInt/NumberLong</td>
<td>默认使用64位浮点型</td>
<td>{“x”:3.14}/{“x”:NumberInt(“3”)}/{“x”:NumberLong(“3”)}</td>
</tr>
<tr>
<td>字符串</td>
<td></td>
<td>{“x”:“foobar”}</td>
</tr>
<tr>
<td>日期</td>
<td></td>
<td>{“x”:new Date()}</td>
</tr>
<tr>
<td>正则表达式</td>
<td>查询时，使用正则表达式作为限定条件，语法与JS相同</td>
<td>{“x”:/foobar/i}</td>
</tr>
<tr>
<td>数组</td>
<td></td>
<td>{“x”:[1,2,3]}</td>
</tr>
<tr>
<td>内嵌文档</td>
<td>文档可内嵌其他文档</td>
<td>{“x”:{“foo”:”bar”}}</td>
</tr>
<tr>
<td>对象id</td>
<td>对象id是一个12字节的ID，是文档的唯一标识</td>
<td>{“x”:ObjectId()}</td>
</tr>
<tr>
<td>二进制数据</td>
<td></td>
<td></td>
</tr>
<tr>
<td>代码</td>
<td>Js代码</td>
<td>{“x”:function() {/<em> … </em>/}}</td>
</tr>
</tbody>
</table>
</blockquote>
<blockquote>
<ul>
<li>Any question please contact <a href="https://www.github.com/1-riverfish" target="_blank" rel="noopener">1-riverfish</a></li>
</ul>
</blockquote>
</p></div><div class="share"><span>分享到</span>&nbsp;<span class="soc"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></span><span class="soc"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></span><span class="soc"><a href="http://twitter.com/home?status=http://yoursite.com/2017/09/23/MongoDB学习笔记2/%20Ginger's blog%20MongoDB学习笔记2" class="fa fa-twitter"></a></span></div><div class="pagination"><p class="clearfix"><span class="pre pagbuttons"><a role="navigation" href="/2017/09/25/MongoDB学习笔记3/" title="MongoDB学习笔记3"><i class="fa fa-angle-double-left"></i>&nbsp;上一篇: MongoDB学习笔记3</a></span><span>&nbsp;</span><span class="next pagbuttons"><a role="navigation" href="/2017/09/23/MongoDB学习笔记1/" title="MongoDB学习笔记1">下一篇: MongoDB学习笔记1&nbsp;<i class="fa fa-angle-double-right"></i></a></span></p></div></div></div></div><div class="visible-xs site-bottom-footer"><footer><p>&copy;&nbsp;2018&nbsp;<a target="_blank" href="http://yoursite.com" rel="noopener noreferrer">1-riverfish</a></p><p>Theme&nbsp;<a target="_blank" href="https://github.com/SumiMakito/hexo-theme-typography" rel="noopener noreferrer">Typography</a>&nbsp;by&nbsp;<a target="_blank" href="https://www.keep.moe" rel="noopener noreferrer">Makito</a></p><p>Proudly published with&nbsp;<a target="_blank" href="https://hexo.io" rel="noopener noreferrer">Hexo</a></p></footer></div></div></div></div><script src="/js/jquery-3.1.0.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/google-analytics.js"></script><script src="/js/typography.js"></script></body></html>